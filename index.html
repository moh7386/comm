<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Thesis Manager - Bilingual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif'],
                        serif: ['Amiri', 'Times New Roman', 'serif'],
                    },
                    colors: {
                        slate: { 850: '#1e293b', 900: '#0f172a' }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f1f5f9; }
        
        /* ورقة A4 للمعاينة والطباعة */
        .a4-paper {
            background: white;
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 25mm;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            font-family: 'Times New Roman', 'Amiri', serif;
            color: #000;
            line-height: 1.6;
            font-size: 14pt;
        }

        /* تنسيق الطباعة الفعلي - إصلاح مشاكل اللغة العربية */
        @media print {
            body * { visibility: hidden; } /* إخفاء الواجهة */
            #proposal-modal { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                height: 100%; 
                background: white; 
                z-index: 9999;
                overflow: visible;
                display: block !important;
            }
            #paper-content, #paper-content * { visibility: visible; } /* إظهار الورقة فقط */
            .a4-paper {
                box-shadow: none;
                margin: 0;
                width: 100%;
                padding: 15mm;
                page-break-after: always;
            }
            .no-print { display: none !important; }
        }

        /* تمييز المناطق القابلة للتعديل */
        [contenteditable="true"]:hover {
            background-color: #fffbeb;
            outline: 1px dashed #d97706;
            cursor: text;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
    </style>
</head>
<body class="text-slate-800 antialiased h-screen flex flex-col overflow-hidden font-sans">

    <!-- Navbar -->
    <nav class="bg-slate-900 text-white shadow-lg z-50 flex-none no-print">
        <div class="max-w-[1920px] mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 w-10 h-10 rounded-lg flex items-center justify-center font-bold text-xl shadow-blue-500/50">20</div>
                <div>
                    <h1 class="font-bold text-lg leading-tight" id="nav-title">مدير المقترحات البحثية</h1>
                    <p class="text-[11px] text-slate-400 font-mono tracking-wider">v4.0 Final Bilingual</p>
                </div>
            </div>
            
            <button onclick="toggleLang()" class="flex items-center gap-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 px-4 py-1.5 rounded-full transition-colors text-sm font-bold group">
                <span class="w-2 h-2 rounded-full bg-green-400 group-hover:animate-pulse"></span>
                <span id="lang-btn-text">English Interface</span>
            </button>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="flex flex-1 overflow-hidden no-print">
        
        <!-- Sidebar -->
        <aside class="w-1/3 max-w-sm bg-white border-r border-slate-200 flex flex-col z-20 shadow-xl">
            <div class="p-4 bg-slate-50 border-b border-slate-200">
                <h2 class="text-xs font-bold text-slate-500 uppercase mb-2 flex justify-between">
                    <span id="sidebar-title">قائمة المواضيع</span>
                    <span class="bg-blue-100 text-blue-700 px-1.5 rounded text-[10px]">20</span>
                </h2>
                <div class="relative">
                    <input type="text" id="search-input" onkeyup="filterList()" placeholder="بحث..." class="w-full pl-9 pr-4 py-2 bg-white border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-shadow">
                    <svg class="w-4 h-4 text-slate-400 absolute top-2.5 left-3 rtl:right-auto rtl:left-3 ltr:left-auto ltr:right-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
            </div>
            <div class="overflow-y-auto flex-1 p-2 space-y-2 bg-slate-50/50" id="topic-list">
                <!-- Topics List -->
            </div>
        </aside>

        <!-- Detail View -->
        <main class="flex-1 flex flex-col relative overflow-hidden bg-slate-100">
            <!-- Empty State -->
            <div id="empty-state" class="absolute inset-0 flex flex-col items-center justify-center text-slate-400 z-0">
                <div class="w-20 h-20 bg-slate-200 rounded-full flex items-center justify-center mb-4">
                    <svg class="w-10 h-10 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                </div>
                <p class="text-xl font-bold" id="select-msg">اختر موضوعاً لاستعراض التفاصيل</p>
            </div>

            <!-- Content Panel -->
            <div id="detail-panel" class="hidden flex-1 flex flex-col h-full overflow-y-auto z-10 fade-in bg-slate-50">
                <div class="bg-white p-8 border-b border-slate-200 shadow-sm sticky top-0 z-20">
                    <div class="flex items-center gap-3 mb-3">
                        <span id="dt-cat" class="px-2.5 py-0.5 bg-blue-100 text-blue-800 rounded-md text-xs font-bold uppercase tracking-wide">CAT</span>
                        <span id="dt-tool" class="px-2.5 py-0.5 bg-slate-100 text-slate-600 rounded-md text-xs font-mono border border-slate-200">TOOL</span>
                    </div>
                    <h1 id="dt-title" class="text-2xl md:text-3xl font-bold text-slate-800 leading-tight mb-1">Title Placeholder</h1>
                </div>

                <div class="p-8 max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 w-full">
                    <!-- Main Info -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Action Button -->
                        <div onclick="openProposalModal()" class="bg-gradient-to-r from-blue-700 to-indigo-800 text-white rounded-xl p-6 shadow-xl cursor-pointer hover:shadow-2xl hover:-translate-y-1 transition-all flex justify-between items-center group">
                            <div>
                                <h3 class="font-bold text-xl mb-1 flex items-center gap-2">
                                    <svg class="w-5 h-5 text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                    <span id="btn-gen-title">تجهيز ملف المقترح (Proposal)</span>
                                </h3>
                                <p class="text-blue-200 text-sm" id="btn-gen-desc">إنشاء ملف كامل جاهز للطباعة والتعديل</p>
                            </div>
                            <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center group-hover:bg-white/20 transition">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                            <h4 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                                <span class="w-1 h-5 bg-blue-500 rounded-full"></span>
                                <span id="lbl-abstract">الملخص</span>
                            </h4>
                            <p id="dt-abstract" class="text-slate-600 leading-relaxed text-justify text-base"></p>
                        </div>
                    </div>

                    <!-- Side Stats -->
                    <div class="space-y-6">
                         <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                            <h4 class="text-xs font-bold text-slate-400 uppercase mb-4 text-center">Difficulty Metrics</h4>
                            <div class="h-48 relative"><canvas id="radarChart"></canvas></div>
                         </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Proposal Modal (Full Screen Overlay) -->
    <div id="proposal-modal" class="hidden fixed inset-0 bg-slate-900/95 backdrop-blur-sm z-50 overflow-y-auto pt-4 pb-20 flex justify-center">
        
        <!-- Toolbar (No Print) -->
        <div class="fixed top-6 left-1/2 transform -translate-x-1/2 bg-white p-2 rounded-full shadow-2xl z-50 flex gap-2 border border-slate-200 no-print transition-all hover:scale-105">
            <button onclick="downloadWord()" class="flex items-center gap-2 bg-blue-700 hover:bg-blue-800 text-white px-6 py-2 rounded-full font-bold transition-colors shadow-md">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                <span id="btn-dl-word">تحميل Word</span>
            </button>
            <button onclick="printProposal()" class="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-full font-bold transition-colors shadow-md">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2-2v4h10z"></path></svg>
                <span id="btn-dl-pdf">حفظ PDF (طباعة)</span>
            </button>
            <div class="w-px bg-slate-300 mx-1"></div>
            <button onclick="closeModal()" class="px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-full font-bold transition-colors">
                <span id="btn-close">إغلاق</span>
            </button>
        </div>

        <!-- Paper Preview Container -->
        <div id="paper-container" class="mt-20 mb-10 w-full flex justify-center">
            <!-- The A4 Paper -->
            <div id="paper-content" class="a4-paper relative">
                
                <!-- 1. Header -->
                <div class="text-center mb-8 pb-6 border-b-2 border-black" contenteditable="true">
                    <p class="text-base font-bold" id="txt-uni">[اسم الجامعة]</p>
                    <p class="text-base font-bold" id="txt-college">[اسم الكلية - اسم القسم]</p>
                    <br>
                    <h1 class="text-2xl font-extrabold uppercase" id="paper-header-text">خطة بحث لرسالة الماجستير</h1>
                    <h2 id="paper-title" class="text-xl font-bold mt-4 border-none text-blue-900" style="border:none;"></h2>
                </div>

                <!-- 2. Meta Info Table-like -->
                <div class="mb-8 p-4 border border-slate-300 rounded bg-slate-50/50 text-base" contenteditable="true">
                    <div class="grid grid-cols-2 gap-y-4">
                        <div><strong><span id="lbl-student">الطالب:</span></strong> [الاسم هنا]</div>
                        <div><strong><span id="lbl-supervisor">المشرف:</span></strong> [الاسم هنا]</div>
                        <div><strong><span id="lbl-date">التاريخ:</span></strong> <span id="paper-date"></span></div>
                    </div>
                </div>

                <!-- 3. Sections -->
                <div class="space-y-6">
                    <div>
                        <h2 class="text-lg font-bold border-b border-black mb-3 uppercase" id="head-intro">1. المقدمة</h2>
                        <p id="paper-intro" contenteditable="true" class="text-justify"></p>
                    </div>

                    <div>
                        <h2 class="text-lg font-bold border-b border-black mb-3 uppercase" id="head-problem">2. مشكلة البحث</h2>
                        <p id="paper-problem" contenteditable="true" class="text-justify"></p>
                        <p class="mt-2 font-bold" id="lbl-questions">أسئلة البحث:</p>
                        <ul id="paper-questions" class="list-disc ltr:pl-6 rtl:pr-6" contenteditable="true"></ul>
                    </div>

                    <div>
                        <h2 class="text-lg font-bold border-b border-black mb-3 uppercase" id="head-objs">3. الأهداف</h2>
                        <ul id="paper-objs" class="list-disc ltr:pl-6 rtl:pr-6" contenteditable="true"></ul>
                    </div>

                    <div>
                        <h2 class="text-lg font-bold border-b border-black mb-3 uppercase" id="head-method">4. المنهجية</h2>
                        <p id="paper-method-intro" contenteditable="true" class="mb-3"></p>
                        
                        <div class="my-4 ltr:pl-4 rtl:pr-4 ltr:border-l-4 rtl:border-r-4 border-slate-300 bg-slate-50 p-3 text-sm" contenteditable="true">
                            <strong><span id="lbl-sys">أ. نموذج النظام:</span></strong>
                            <p id="paper-sys-model" class="mt-1"></p>
                        </div>
                        
                        <div class="my-4 ltr:pl-4 rtl:pr-4 ltr:border-l-4 rtl:border-r-4 border-slate-300 bg-slate-50 p-3 text-sm" contenteditable="true">
                            <strong><span id="lbl-algo">ب. الخوارزميات:</span></strong>
                            <p id="paper-algo" class="mt-1"></p>
                        </div>

                        <div class="my-4 ltr:pl-4 rtl:pr-4 ltr:border-l-4 rtl:border-r-4 border-slate-300 bg-slate-50 p-3 text-sm" contenteditable="true">
                            <strong><span id="lbl-tools">ج. الأدوات:</span></strong>
                            <p id="paper-tools" class="mt-1"></p>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-lg font-bold border-b border-black mb-3 uppercase" id="head-outcomes">5. النتائج المتوقعة</h2>
                        <ul id="paper-outcomes" class="list-disc ltr:pl-6 rtl:pr-6" contenteditable="true"></ul>
                    </div>

                    <div>
                        <h2 class="text-lg font-bold border-b border-black mb-3 uppercase" id="head-refs">6. المراجع</h2>
                        <ul id="paper-refs" class="dir-ltr text-left font-serif text-sm list-decimal pl-6" contenteditable="true"></ul>
                    </div>
                </div>

                <!-- Footer Signatures -->
                <div class="mt-16 pt-8 border-t-2 border-black flex justify-between" contenteditable="true">
                    <div class="text-center w-1/3">
                        <p class="font-bold" id="lbl-sig-student">توقيع الطالب</p>
                        <br><br>
                        <p>__________________</p>
                    </div>
                    <div class="text-center w-1/3">
                        <p class="font-bold" id="lbl-sig-super">توقيع المشرف</p>
                        <br><br>
                        <p>__________________</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- 20 Topics Data with FULL Bilingual Content ---
        const topics = [
            // 1. Semantic Comm
            {
                id: 1, cat: "6G / AI", tool: "Python/PyTorch",
                content: {
                    ar: {
                        title: "نظام اتصالات دلالي (Semantic Comm) لنقل الصور بكفاءة عالية",
                        abstract: "يهدف البحث إلى تجاوز حد شانون من خلال نقل 'المعنى' بدلاً من البتات الخام، باستخدام شبكات التعلم العميق (Deep Autoencoders) لاستخراج الميزات الدلالية للصور.",
                        intro: "تشهد شبكات الجيل السادس (6G) تحولاً نوعياً من نقل البيانات (Data Transmission) إلى نقل المعنى. في حين تركز الأنظمة التقليدية على توصيل البتات بدقة، تركز الاتصالات الدلالية على توصيل المعنى المقصود، مما يفتح آفاقاً جديدة لكفاءة الطيف.",
                        problem: "تواجه الأنظمة التقليدية انخفاضاً حاداً في الأداء عند إرسال صور عالية الدقة عبر قنوات ذات نطاق ترددي ضيق وضجيج عالٍ (Low SNR)، حيث تهدر الموارد في إرسال تفاصيل بيكسل غير ضرورية.",
                        questions: ["كيف يمكن استخراج الميزات الدلالية من الصور بدقة؟", "ما هو تأثير القناة اللاسلكية المتغيرة على المعلومات الدلالية؟", "كيف يتفوق نظام JSCC المقترح على الأنظمة التقليدية؟"],
                        objs: ["تصميم معمارية شبكة عصبية عميقة (Deep Autoencoder).", "تطوير طبقة قناة قابلة للاشتقاق للتدريب من طرف لطرف.", "مقارنة الأداء باستخدام مقاييس الإدراك (PSNR, SSIM)."],
                        sys: "يتكون النظام من مرسل دلالي (Encoder) وقناة لاسلكية (AWGN/Rayleigh) ومستقبل دلالي (Decoder).",
                        algo: "Joint Source-Channel Coding (JSCC) باستخدام دالة خسارة دلالية.",
                        outcomes: ["نموذج أولي لنظام اتصالات دلالي.", "توفير في النطاق الترددي بنسبة تصل إلى 90% مقارنة بـ JPEG."],
                        refs: ["H. Xie, Z. Qin, G. Y. Li, 'Deep Learning Enabled Semantic Communication Systems,' IEEE Trans. Signal Process., 2021.", "D. Gündüz et al., 'Beyond Transmitting Bits: Context, Semantics, and Task-Oriented Communications,' IEEE JSAC, 2023."]
                    },
                    en: {
                        title: "Deep Learning Enabled Semantic Communication for Efficient Image Transmission",
                        abstract: "Aiming to surpass Shannon's limit by transmitting 'meaning' rather than raw bits, using Deep Autoencoders to extract semantic features from images.",
                        intro: "6G networks are witnessing a paradigm shift from Data Transmission to Semantic Transmission. While traditional systems focus on bit accuracy, semantic communication focuses on conveying meaning, unlocking new spectral efficiency.",
                        problem: "Traditional systems suffer severe performance degradation when transmitting HD images over low-bandwidth, low-SNR channels, wasting resources on irrelevant pixel details.",
                        questions: ["How to accurately extract semantic features?", "How does the fading channel affect semantic info?", "How does JSCC outperform separation-based schemes?"],
                        objs: ["Design a Deep Autoencoder architecture.", "Develop a differentiable channel layer for end-to-end training.", "Compare performance using perceptual metrics (PSNR, SSIM)."],
                        sys: "The system consists of a Semantic Encoder, Wireless Channel (AWGN/Rayleigh), and Semantic Decoder.",
                        algo: "Joint Source-Channel Coding (JSCC) with semantic loss function.",
                        outcomes: ["Prototype of a semantic communication system.", "Up to 90% bandwidth saving compared to JPEG."],
                        refs: ["H. Xie, Z. Qin, G. Y. Li, 'Deep Learning Enabled Semantic Communication Systems,' IEEE Trans. Signal Process., 2021.", "D. Gündüz et al., 'Beyond Transmitting Bits: Context, Semantics, and Task-Oriented Communications,' IEEE JSAC, 2023."]
                    }
                }
            },
            // 2. ISAC
            {
                id: 2, cat: "ISAC", tool: "MATLAB",
                content: {
                    ar: {
                        title: "تصميم موجة OTFS للتحسس والاتصال المشترك (ISAC) في بيئات عالية التنقل",
                        abstract: "دمج وظيفتي الرادار والاتصال في إشارة واحدة باستخدام تعديل OTFS للتغلب على تأثير دوبلر العالي في شبكات المركبات.",
                        intro: "تتطلب المركبات ذاتية القيادة قدرات اتصال موثوقة واستشعار دقيق للمحيط. تقنية ISAC تدمج هاتين الوظيفتين لتوفير الطيف والطاقة.",
                        problem: "تعاني موجات OFDM التقليدية من تداخل بين الحوامل (ICI) عند السرعات العالية بسبب انزياح دوبلر، مما يقلل من دقة الرادار وموثوقية الاتصال.",
                        questions: ["كيف يمكن تصميم إشارة OTFS مزدوجة الوظيفة؟", "ما هي دقة الرادار المحققة في مجال التأخير-دوبلر؟"],
                        objs: ["تصميم إطار إشارة OTFS.", "تحليل دالة الغموض الرادارية.", "تقييم معدل الخطأ في الاتصال."],
                        sys: "نظام إرسال واستقبال OTFS مع وجود أهداف رادارية ومستخدمي اتصال.",
                        algo: "Message Passing Detection و Range-Velocity Estimation.",
                        outcomes: ["شكل موجة مقاوم لتأثير دوبلر.", "دقة عالية في كشف سرعة ومكان الأهداف."],
                        refs: ["P. Raviteja et al., 'OTFS Modulation for Future Wireless Networks,' IEEE Wireless Commun., 2020.", "F. Liu et al., 'Integrated Sensing and Communications,' IEEE T-WCOM, 2022."]
                    },
                    en: {
                        title: "OTFS Waveform Design for Integrated Sensing and Comm (ISAC) in High-Mobility Environments",
                        abstract: "Merging Radar and Communication into a single waveform using OTFS modulation to combat high Doppler shifts in vehicular networks.",
                        intro: "Autonomous vehicles require reliable comms and accurate sensing. ISAC merges these functionalities to save spectrum and energy.",
                        problem: "Traditional OFDM suffers from Inter-Carrier Interference (ICI) at high speeds due to Doppler shifts, degrading both radar accuracy and comms reliability.",
                        questions: ["How to design a dual-function OTFS waveform?", "What is the achievable radar resolution in Delay-Doppler domain?"],
                        objs: ["Design OTFS frame structure.", "Analyze Radar Ambiguity Function.", "Evaluate Bit Error Rate (BER)."],
                        sys: "OTFS Transceiver system with radar targets and comms users.",
                        algo: "Message Passing Detection and Range-Velocity Estimation.",
                        outcomes: ["Doppler-resilient waveform.", "High accuracy in target range/velocity estimation."],
                        refs: ["P. Raviteja et al., 'OTFS Modulation for Future Wireless Networks,' IEEE Wireless Commun., 2020.", "F. Liu et al., 'Integrated Sensing and Communications,' IEEE T-WCOM, 2022."]
                    }
                }
            },
            // 3. Active RIS
            {
                id: 3, cat: "RIS / AI", tool: "Python/TensorFlow",
                content: {
                    ar: {
                        title: "تحسين كفاءة الطاقة في الأسطح الذكية النشطة (Active RIS) باستخدام التعلم العميق المعزز",
                        abstract: "استخدام عناصر نشطة في RIS لتعويض خسارة المسار، وضبطها باستخدام خوارزمية DRL لتعظيم كفاءة الطاقة.",
                        intro: "تعد الأسطح الذكية (RIS) حلاً واعداً للتغطية، لكن النوع السلبي يعاني من توهين مضاعف. الأسطح النشطة تحل المشكلة ولكنها تستهلك طاقة.",
                        problem: "صعوبة الموازنة اللحظية بين تكبير الإشارة واستهلاك الطاقة والضجيج الحراري في مصفوفة معقدة.",
                        questions: ["كيف نضبط طور وتكبير العناصر في الزمن الحقيقي؟", "كيف نوازن بين الأداء والطاقة؟"],
                        objs: ["صياغة مسألة تعظيم كفاءة الطاقة.", "تطوير خوارزمية DDPG للتحكم.", "المقارنة مع Passive RIS."],
                        sys: "محطة قاعدة + Active RIS + مستخدمين.",
                        algo: "Deep Deterministic Policy Gradient (DDPG).",
                        outcomes: ["خوارزمية تحكم ذكية.", "تحسين تغطية المستخدمين عند الحافة."],
                        refs: ["Z. Zhang et al., 'Active RIS vs. Passive RIS,' IEEE Trans. Commun., 2023.", "C. Huang et al., 'Reconfigurable Intelligent Surfaces for Energy Efficiency,' IEEE T-WCOM, 2019."]
                    },
                    en: {
                        title: "Energy Efficiency Optimization in Active RIS using Deep Reinforcement Learning",
                        abstract: "Using active elements in RIS to compensate for path loss, optimized via DRL algorithms to maximize energy efficiency.",
                        intro: "RIS is promising for coverage, but passive types suffer double fading. Active RIS solves this but consumes power.",
                        problem: "Difficulty in real-time balancing of signal amplification, power consumption, and thermal noise in a complex array.",
                        questions: ["How to tune phase/amplification in real-time?", "How to trade-off performance vs power?"],
                        objs: ["Formulate Energy Efficiency problem.", "Develop DDPG control algorithm.", "Compare with Passive RIS."],
                        sys: "Base Station + Active RIS + Users.",
                        algo: "Deep Deterministic Policy Gradient (DDPG).",
                        outcomes: ["Intelligent control algorithm.", "Improved coverage for edge users."],
                        refs: ["Z. Zhang et al., 'Active RIS vs. Passive RIS,' IEEE Trans. Commun., 2023.", "C. Huang et al., 'Reconfigurable Intelligent Surfaces for Energy Efficiency,' IEEE T-WCOM, 2019."]
                    }
                }
            }
        ];

        // Generate Filler Topics (4-20)
        for(let i=4; i<=20; i++) {
            topics.push({
                id: i, cat: "Advanced Comm", tool: "MATLAB/Python",
                content: {
                    ar: {
                        title: `موضوع بحثي متقدم رقم ${i} في الجيل السادس`,
                        abstract: "دراسة تحليلية ومحاكاة لتحسين أداء الشبكات اللاسلكية المستقبلية في ظل القيود الحالية.",
                        intro: "تواجه شبكات الاتصالات طلباً متزايداً على السرعة والموثوقية، مما يتطلب حلولاً هندسية مبتكرة.",
                        problem: "محدودية الطيف واستهلاك الطاقة العالي في الشبكات الحالية.",
                        questions: ["كيف يمكن تحسين الكفاءة الطيفية؟", "ما هو دور الخوارزميات الذكية؟"],
                        objs: ["بناء نموذج رياضي للنظام.", "تطوير خوارزمية تحسين.", "تقييم الأداء بالمحاكاة."],
                        sys: "نظام اتصالات MIMO متعدد المستخدمين.",
                        algo: "خوارزمية تحسين محدبة (Convex Optimization).",
                        outcomes: ["زيادة في معدل النقل.", "تقليل استهلاك الطاقة."],
                        refs: ["Reference 1 (IEEE Format).", "Reference 2 (IEEE Format)."]
                    },
                    en: {
                        title: `Advanced Research Topic #${i} in 6G Networks`,
                        abstract: "Analytical study and simulation to enhance future wireless network performance under current constraints.",
                        intro: "Telecom networks face increasing demand for speed and reliability, requiring innovative engineering solutions.",
                        problem: "Spectrum scarcity and high energy consumption in current networks.",
                        questions: ["How to improve spectral efficiency?", "What is the role of intelligent algorithms?"],
                        objs: ["Build mathematical system model.", "Develop optimization algorithm.", "Evaluate performance via simulation."],
                        sys: "Multi-user MIMO communication system.",
                        algo: "Convex Optimization Algorithm.",
                        outcomes: ["Increased throughput.", "Reduced energy consumption."],
                        refs: ["Reference 1 (IEEE Format).", "Reference 2 (IEEE Format)."]
                    }
                }
            });
        }

        // --- Logic ---
        let currentLang = 'ar';
        let currentTopic = null;
        let chartInstance = null;

        const ui = {
            ar: { 
                navTitle: "مدير المقترحات البحثية", btnLang: "English Interface", sidebarTitle: "قائمة المواضيع", selectMsg: "اختر موضوعاً لاستعراض التفاصيل",
                btnGenTitle: "تجهيز ملف المقترح (Proposal)", btnGenDesc: "إنشاء ملف كامل جاهز للطباعة والتعديل", lblAbstract: "الملخص",
                // Modal Labels
                btnWord: "تحميل Word", btnPdf: "حفظ PDF (طباعة)", btnClose: "إغلاق",
                // Paper Labels
                txtUni: "[اسم الجامعة]", txtCollege: "[اسم الكلية - اسم القسم]",
                paperHeader: "خطة بحث لرسالة الماجستير",
                lblStudent: "الطالب:", lblSupervisor: "المشرف:", lblDate: "التاريخ:",
                headIntro: "1. المقدمة", headProblem: "2. مشكلة البحث", lblQuestions: "أسئلة البحث:",
                headObjs: "3. الأهداف", headMethod: "4. المنهجية",
                lblSys: "أ. نموذج النظام:", lblAlgo: "ب. الخوارزميات:", lblTools: "ج. الأدوات:",
                headOutcomes: "5. النتائج المتوقعة", headRefs: "6. المراجع",
                lblSigStudent: "توقيع الطالب", lblSigSuper: "توقيع المشرف"
            },
            en: { 
                navTitle: "Thesis Proposal Manager", btnLang: "الواجهة العربية", sidebarTitle: "Topics List", selectMsg: "Select a topic to view details",
                btnGenTitle: "Prepare Proposal File", btnGenDesc: "Create full printable/editable file", lblAbstract: "Abstract",
                // Modal Labels
                btnWord: "Download Word", btnPdf: "Save PDF (Print)", btnClose: "Close",
                // Paper Labels
                txtUni: "[University Name]", txtCollege: "[College Name - Department]",
                paperHeader: "Master's Thesis Proposal",
                lblStudent: "Student:", lblSupervisor: "Supervisor:", lblDate: "Date:",
                headIntro: "1. Introduction", headProblem: "2. Problem Statement", lblQuestions: "Research Questions:",
                headObjs: "3. Objectives", headMethod: "4. Methodology",
                lblSys: "A. System Model:", lblAlgo: "B. Algorithms:", lblTools: "C. Tools:",
                headOutcomes: "5. Expected Outcomes", headRefs: "6. References",
                lblSigStudent: "Student Signature", lblSigSuper: "Supervisor Signature"
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            renderList();
            document.getElementById('paper-date').textContent = new Date().toLocaleDateString('en-GB');
        });

        function toggleLang() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            updateUI();
            renderList();
            if(currentTopic) loadTopic(currentTopic.id);
        }

        function updateUI() {
            const t = ui[currentLang];
            document.getElementById('nav-title').textContent = t.navTitle;
            document.getElementById('lang-btn-text').textContent = t.btnLang;
            document.getElementById('sidebar-title').textContent = t.sidebarTitle;
            document.getElementById('select-msg').textContent = t.selectMsg;
            document.getElementById('btn-gen-title').textContent = t.btnGenTitle;
            document.getElementById('btn-gen-desc').textContent = t.btnGenDesc;
            document.getElementById('lbl-abstract').textContent = t.lblAbstract;

            // Modal Buttons
            document.getElementById('btn-dl-word').textContent = t.btnWord;
            document.getElementById('btn-dl-pdf').textContent = t.btnPdf;
            document.getElementById('btn-close').textContent = t.btnClose;

            // Paper Static Text
            document.getElementById('txt-uni').textContent = t.txtUni;
            document.getElementById('txt-college').textContent = t.txtCollege;
            document.getElementById('paper-header-text').textContent = t.paperHeader;
            
            document.getElementById('lbl-student').textContent = t.lblStudent;
            document.getElementById('lbl-supervisor').textContent = t.lblSupervisor;
            document.getElementById('lbl-date').textContent = t.lblDate;
            
            document.getElementById('head-intro').textContent = t.headIntro;
            document.getElementById('head-problem').textContent = t.headProblem;
            document.getElementById('lbl-questions').textContent = t.lblQuestions;
            
            document.getElementById('head-objs').textContent = t.headObjs;
            document.getElementById('head-method').textContent = t.headMethod;
            document.getElementById('lbl-sys').textContent = t.lblSys;
            document.getElementById('lbl-algo').textContent = t.lblAlgo;
            document.getElementById('lbl-tools').textContent = t.lblTools;
            
            document.getElementById('head-outcomes').textContent = t.headOutcomes;
            document.getElementById('head-refs').textContent = t.headRefs;
            
            document.getElementById('lbl-sig-student').textContent = t.lblSigStudent;
            document.getElementById('lbl-sig-super').textContent = t.lblSigSuper;
        }

        function renderList() {
            const list = document.getElementById('topic-list');
            list.innerHTML = '';
            topics.forEach(t => {
                const c = t.content[currentLang];
                const el = document.createElement('div');
                el.className = 'p-3 mb-2 bg-white border border-slate-200 rounded hover:bg-blue-50 cursor-pointer transition-colors shadow-sm';
                el.innerHTML = `<div class="text-[10px] font-bold text-blue-600 uppercase mb-1">${t.cat}</div><div class="text-xs font-bold text-slate-700">${c.title}</div>`;
                el.onclick = () => loadTopic(t.id);
                list.appendChild(el);
            });
        }

        function filterList() {
            const q = document.getElementById('search-input').value.toLowerCase();
            const list = document.getElementById('topic-list');
            list.innerHTML = '';
            topics.forEach(t => {
                const c = t.content[currentLang];
                if(c.title.toLowerCase().includes(q) || t.cat.toLowerCase().includes(q)) {
                    const el = document.createElement('div');
                    el.className = 'p-3 mb-2 bg-white border border-slate-200 rounded hover:bg-blue-50 cursor-pointer transition-colors shadow-sm';
                    el.innerHTML = `<div class="text-[10px] font-bold text-blue-600 uppercase mb-1">${t.cat}</div><div class="text-xs font-bold text-slate-700">${c.title}</div>`;
                    el.onclick = () => loadTopic(t.id);
                    list.appendChild(el);
                }
            });
        }

        function loadTopic(id) {
            currentTopic = topics.find(t => t.id === id);
            const c = currentTopic.content[currentLang];
            
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('detail-panel').classList.remove('hidden');
            
            document.getElementById('dt-cat').textContent = currentTopic.cat;
            document.getElementById('dt-tool').textContent = currentTopic.tool;
            document.getElementById('dt-title').textContent = c.title;
            document.getElementById('dt-abstract').textContent = c.abstract;

            updateChart();
        }

        function openProposalModal() {
            if(!currentTopic) return;
            const c = currentTopic.content[currentLang];
            const methodIntro = currentLang === 'ar' ? 
                `تعتمد هذه الرسالة على منهجية المحاكاة الحاسوبية والتحليل الرياضي باستخدام بيئة ${currentTopic.tool}.` : 
                `This thesis relies on computer simulation methodology and mathematical analysis using the ${currentTopic.tool} environment.`;

            // Fill Paper Data
            document.getElementById('paper-title').textContent = c.title;
            
            document.getElementById('paper-intro').textContent = c.intro;
            document.getElementById('paper-problem').textContent = c.problem;
            
            document.getElementById('paper-questions').innerHTML = c.questions.map(q => `<li>${q}</li>`).join('');
            document.getElementById('paper-objs').innerHTML = c.objs.map(o => `<li>${o}</li>`).join('');
            
            document.getElementById('paper-method-intro').textContent = methodIntro;
            document.getElementById('paper-sys-model').textContent = c.sys;
            document.getElementById('paper-algo').textContent = c.algo;
            document.getElementById('paper-tools').textContent = currentTopic.tool;
            
            document.getElementById('paper-outcomes').innerHTML = c.outcomes.map(o => `<li>${o}</li>`).join('');
            document.getElementById('paper-refs').innerHTML = c.refs.map(r => `<li>${r}</li>`).join('');

            document.getElementById('proposal-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('proposal-modal').classList.add('hidden');
        }

        function printProposal() {
            window.print();
        }

        function downloadWord() {
            const header = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' 
                      xmlns:w='urn:schemas-microsoft-com:office:word' 
                      xmlns='http://www.w3.org/TR/REC-html40' dir='${currentLang === 'ar' ? 'rtl' : 'ltr'}'>
                <head>
                    <meta charset='utf-8'>
                    <title>${currentTopic.content[currentLang].title}</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; font-size: 12pt; }
                        h1 { font-size: 16pt; font-weight: bold; text-align: center; }
                        h2 { font-size: 14pt; font-weight: bold; border-bottom: 1px solid #000; margin-top: 20px; }
                        p { text-align: justify; line-height: 1.5; }
                        li { margin-bottom: 5px; }
                    </style>
                </head><body>`;
            
            const content = document.getElementById("paper-content").innerHTML;
            const sourceHTML = header + content + "</body></html>";
            
            const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
            const fileDownload = document.createElement("a");
            document.body.appendChild(fileDownload);
            fileDownload.href = source;
            fileDownload.download = 'Thesis_Proposal.doc';
            fileDownload.click();
            document.body.removeChild(fileDownload);
        }

        function updateChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Novelty', 'Math Depth', 'Sim Complexity', 'Data Availability', 'Coding Skill'],
                    datasets: [{
                        label: 'Metrics',
                        data: [85, 75, 60, 50, 80],
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: '#2563eb',
                        pointBackgroundColor: '#2563eb'
                    }]
                },
                options: {
                    scales: { r: { suggestMin: 0, suggestMax: 100, ticks: { display: false } } },
                    plugins: { legend: { display: false } }
                }
            });
        }
    </script>
</body>
</html>
